# Share Functionality Implementation

## Overview

The Bisa app now includes a comprehensive share functionality that allows users to share posts across multiple platforms and provides detailed analytics on sharing activity.

## Features

### 1. Multiple Sharing Options
- **Native Share**: Uses device's native sharing capabilities
- **Social Media**: Direct sharing to Twitter, Facebook, WhatsApp, and Telegram
- **Copy Options**: Copy link or copy post content to clipboard
- **Custom Share Modal**: Beautiful, intuitive interface for sharing options

### 2. Share Analytics
- **Real-time Tracking**: Track all share activities with metadata
- **Share Statistics**: View breakdown by platform and share type
- **User Analytics**: Track individual user sharing behavior
- **Visual Analytics**: Clean, modern interface for viewing stats

### 3. Backend Integration
- **Database Tracking**: Store all share activities in PostgreSQL
- **API Endpoints**: RESTful endpoints for share operations
- **Analytics API**: Endpoints for retrieving share statistics

## Backend Implementation

### Models

#### Share Model (`Share.java`)
```java
@Entity
@Table(name = "post_shares")
public class Share {
    private Long id;
    private Post post;
    private User user;
    private String shareType; // 'native', 'twitter', 'facebook', etc.
    private Instant sharedAt;
    private String platform; // 'app', 'web', 'mobile'
    private String userAgent;
}
```

#### ShareRequest DTO (`ShareRequest.java`)
```java
public class ShareRequest {
    private String shareType;
    private String platform;
    private String userAgent;
}
```

### API Endpoints

#### Share a Post
```
POST /api/posts/{id}/share
Content-Type: application/json
Authorization: Bearer <token>

{
  "share_type": "twitter",
  "platform": "mobile",
  "user_agent": "Bisa/1.0"
}
```

#### Get Share Statistics
```
GET /api/posts/{id}/shares/stats
Authorization: Bearer <token>

Response:
{
  "totalShares": 15,
  "shareTypeStats": [
    ["twitter", 5],
    ["facebook", 3],
    ["native", 4],
    ["copy_link", 2],
    ["whatsapp", 1]
  ],
  "postId": "123"
}
```

#### Get Share History
```
GET /api/posts/{id}/shares
Authorization: Bearer <token>

Response: Array of Share objects with user and timestamp data
```

### Database Schema

#### post_shares Table
```sql
CREATE TABLE post_shares (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    post_id BIGINT REFERENCES post(id),
    user_id BIGINT REFERENCES app_user(id),
    share_type VARCHAR(255),
    shared_at TIMESTAMP WITH TIME ZONE,
    platform VARCHAR(255),
    user_agent TEXT
);
```

## Frontend Implementation

### Components

#### ShareModal (`ShareModal.tsx`)
- **Multiple Share Options**: Grid layout with icons and labels
- **Preview Section**: Shows post content preview before sharing
- **Platform Integration**: Direct links to social media platforms
- **Clipboard Support**: Copy link and text functionality
- **Error Handling**: Graceful error handling with user feedback

#### ShareAnalytics (`ShareAnalytics.tsx`)
- **Statistics Display**: Total shares and breakdown by type
- **Visual Indicators**: Icons and colors for different share types
- **Loading States**: Smooth loading animations
- **Error Recovery**: Retry functionality for failed requests

#### QuestionCard Integration
- **Share Button**: Integrated share button with count display
- **Long Press**: Long press on share button shows analytics
- **State Management**: Local state updates for immediate feedback

### API Integration

#### Share Functions (`api.ts`)
```typescript
// Share a post with metadata
export async function sharePost(
  postId: string, 
  token: string, 
  shareData?: {
    shareType: string;
    platform: string;
    userAgent?: string;
  }
) {
  // Implementation
}

// Get share statistics
export async function getShareStats(postId: string, token: string) {
  // Implementation
}

// Get share history
export async function getPostShares(postId: string, token: string) {
  // Implementation
}
```

## Usage Examples

### Basic Share
```typescript
// Simple share (increments count only)
await sharePost(postId, token);

// Share with metadata
await sharePost(postId, token, {
  shareType: 'twitter',
  platform: 'mobile'
});
```

### View Analytics
```typescript
// Get share statistics
const stats = await getShareStats(postId, token);
console.log(`Total shares: ${stats.totalShares}`);
console.log(`Twitter shares: ${stats.shareTypeStats.find(([type]) => type === 'twitter')?.[1] || 0}`);
```

## Share Types Supported

1. **native** - Device's native share sheet
2. **twitter** - Direct Twitter sharing
3. **facebook** - Direct Facebook sharing
4. **whatsapp** - Direct WhatsApp sharing
5. **telegram** - Direct Telegram sharing
6. **copy_link** - Copy post link to clipboard
7. **copy_text** - Copy post content to clipboard

## Platform Support

- **mobile** - Mobile app (React Native)
- **web** - Web application
- **app** - Generic app identifier

## Analytics Features

### Share Statistics
- Total share count per post
- Breakdown by share type
- Platform usage statistics
- Time-based analytics (future enhancement)

### User Analytics
- Individual user sharing behavior
- Most shared posts
- Popular sharing platforms

## Security Considerations

1. **Authentication**: All share endpoints require valid Firebase token
2. **Rate Limiting**: Implement rate limiting for share endpoints (future enhancement)
3. **Data Privacy**: Share data is stored securely with user consent
4. **Input Validation**: All share requests are validated and sanitized

## Performance Optimizations

1. **Caching**: Share statistics are cached for better performance
2. **Lazy Loading**: Analytics data is loaded on demand
3. **Optimistic Updates**: UI updates immediately, syncs with backend
4. **Error Recovery**: Graceful handling of network failures

## Future Enhancements

1. **Deep Linking**: Direct links to specific posts
2. **Share Rewards**: Gamification for sharing activity
3. **Advanced Analytics**: Time-based trends and insights
4. **Social Proof**: Display share counts prominently
5. **Viral Tracking**: Track how shares spread across networks

## Testing

### Backend Testing
```bash
# Test share endpoint
curl -X POST http://localhost:8080/api/posts/1/share \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"share_type": "twitter", "platform": "mobile"}'

# Test analytics endpoint
curl -X GET http://localhost:8080/api/posts/1/shares/stats \
  -H "Authorization: Bearer <token>"
```

### Frontend Testing
1. Test share modal opens correctly
2. Test all share options work
3. Test analytics modal displays data
4. Test error handling scenarios
5. Test offline behavior

## Dependencies

### Backend
- Spring Boot 3.5.3
- Spring Data JPA
- PostgreSQL
- Jackson for JSON processing

### Frontend
- React Native
- Expo Clipboard
- React Native Share
- Expo Linking

## Configuration

### Environment Variables
```properties
# Database configuration (already configured)
spring.datasource.url=jdbc:postgresql://localhost:5432/bisa
spring.datasource.username=postgres
spring.datasource.password=password

# Logging for share analytics
logging.level.com.bisa.controller.PostController=DEBUG
```

## Troubleshooting

### Common Issues

1. **Share count not updating**
   - Check if user is authenticated
   - Verify API endpoint is accessible
   - Check network connectivity

2. **Analytics not loading**
   - Verify database connection
   - Check if share data exists
   - Review API response format

3. **Social media links not working**
   - Verify URL encoding
   - Check if apps are installed
   - Test with different platforms

### Debug Commands
```bash
# Check share table
psql -d bisa -c "SELECT * FROM post_shares ORDER BY shared_at DESC LIMIT 10;"

# Check share statistics
psql -d bisa -c "SELECT share_type, COUNT(*) FROM post_shares GROUP BY share_type;"
```

## Support

For issues or questions about the share functionality:
1. Check the logs for error messages
2. Verify API endpoints are working
3. Test with different share types
4. Review database schema and data

The share functionality is now fully integrated and ready for production use! 